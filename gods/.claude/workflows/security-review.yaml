workflow:
  id: security-review
  name: Comprehensive Security Review
  description: >
    End-to-end security assessment workflow including threat modeling,
    vulnerability analysis, and remediation planning.
  type: security-focused
  agents_involved:
    - security
    - architect
    - developer
    - qa
  estimated_duration: 2-3 hours
  priority: high

sequence:
  - step: 1
    name: Threat Modeling
    agent: security
    action: Create comprehensive threat model
    commands:
      - "*threat-model"
      - "*risk-assessment"
    creates:
      - threat-model.md
      - attack-vectors.md
      - risk-matrix.md
    outputs:
      - identified_threats
      - risk_scores
      - critical_assets

  - step: 2
    name: Architecture Security Review
    agent: architect
    action: Review architecture for security weaknesses
    requires:
      - threat-model.md
    commands:
      - "*analyze"
      - "*review-design"
    creates:
      - security-architecture-review.md
      - hardening-recommendations.md
    decision_point:
      condition: major_redesign_needed
      true_path: architecture_redesign
      false_path: continue

  - step: 3
    name: Architecture Redesign
    agent: architect
    action: Redesign architecture for security
    condition: architecture_redesign
    creates:
      - secure-architecture-v2.md
      - migration-plan.md

  - step: 4
    name: Secure Implementation Guide
    agent: developer
    action: Create secure coding guidelines
    requires:
      - threat-model.md
      - security-architecture-review.md
    commands:
      - "*best-practices"
      - "*implement"
    creates:
      - secure-coding-guide.md
      - security-controls-implementation.md
      - code-review-checklist.md

  - step: 5
    name: Security Test Planning
    agent: qa
    action: Design security testing strategy
    requires:
      - threat-model.md
      - secure-coding-guide.md
    commands:
      - "*test-strategy"
      - "*pentest-prep"
    creates:
      - security-test-plan.md
      - penetration-test-scope.md
      - security-validation-checklist.md

  - step: 6
    name: Compliance Check
    agent: security
    action: Verify compliance requirements
    commands:
      - "*compliance-check"
    creates:
      - compliance-matrix.md
      - gap-analysis.md
      - remediation-requirements.md

  - step: 7
    name: Final Security Assessment
    agent: security
    action: Synthesize findings and create action plan
    requires:
      - all_previous_artifacts
    creates:
      - executive-security-summary.md
      - security-action-plan.md
      - security-metrics.md

decision_points:
  major_redesign_needed:
    description: Whether architecture needs significant security redesign
    criteria:
      - Critical vulnerabilities in core design
      - Inability to implement required controls
      - Compliance blockers
    impact: Adds 1-2 hours to workflow

  compliance_required:
    description: Level of compliance documentation needed
    options:
      none: No specific compliance requirements
      standard: Industry standard compliance (SOC2, etc.)
      regulated: Regulatory compliance (HIPAA, PCI-DSS, etc.)

risk_thresholds:
  critical: Immediate action required
  high: Address before production
  medium: Include in next iteration
  low: Track and monitor

handoff_templates:
  security_to_architect: |
    Threat model complete. Critical findings:
    - {critical_count} critical risks identified
    - Key attack vectors: {vectors}
    - Recommended controls: {controls}
    Please review for architectural impact.

  architect_to_developer: |
    Security architecture review complete.
    Required implementation changes:
    - {change_1}
    - {change_2}
    See hardening-recommendations.md for details.

  developer_to_qa: |
    Secure implementation guide ready.
    Critical test areas:
    - {test_area_1}
    - {test_area_2}
    Security controls implemented: {control_list}

artifacts:
  classification: sensitive
  retention: permanent
  storage_path: docs/baco/security/{workflow_id}/{timestamp}

escalation_triggers:
  - Critical vulnerability discovered
  - Compliance violation found
  - Data breach risk identified
  - Authentication bypass possible

completion_criteria:
  - All identified risks have mitigation plans
  - Security controls are documented
  - Test plans cover all threat vectors
  - Compliance requirements addressed
  - Clear security posture statement

deliverables:
  mandatory:
    - Threat model
    - Security architecture review
    - Security action plan
  optional:
    - Penetration test scope
    - Compliance matrix
    - Security training materials